---
// src/pages/index.astro - Page d'accueil
import Layout from '@/layouts/layout.astro';
import {getSingleEntry} from '@/contentstack-sdk/fetchContent';
import '@/styles/index.scss';
import PageContent from '@/components/react/PageContent';

// Activer le server-side rendering
export const prerender = false;

// Détection du mode preview via env
const isPreview = import.meta.env.PUBLIC_IS_PREVIEW === 'true';
const currentUrl = Astro.url.pathname;

// En mode production : fetch la page côté serveur
let page;
if (!isPreview) {
    page = await getSingleEntry('page', {url: currentUrl});

    if (!page) {
        return Astro.redirect('/404');
    }
}
---

<Layout
    title={page?.seo_title || page?.title || 'Accueil'}
    description={page?.seo_description}
>
    {isPreview ? (
        <PageContent url={currentUrl} client:only="preact" />
    ) : (
        <PageContent page={page} client:load />
    )}
</Layout>