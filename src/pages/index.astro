---
// src/pages/index.astro - Page d'accueil utilisant la même logique dynamique
import Layout from '@/layouts/layout.astro';
import { getSingleEntry } from '@/contentstack-sdk/fetchContent';
import '@/styles/index.scss';
import PageContent from '@/components/pageContent.astro';
import PreviewWrapper from '@/components/react/PreviewWrapper';

// Activer le server-side rendering
export const prerender = false;

// Récupérer la page d'accueil depuis Contentstack
const page = await getSingleEntry('page', { url: '/' });

// Détection du mode preview via env
const isPreview = import.meta.env.PUBLIC === 'true';

if (!page) {
  return Astro.redirect('/404');
}

const { title, seo_title, seo_description } = page;
---

<Layout 
  title={seo_title || title || 'Accueil'}
  description={seo_description}
>
  {isPreview ? (
    <PreviewWrapper client:only="preact" />
  ) : (
    <PageContent page={page} />
  )}
</Layout>

