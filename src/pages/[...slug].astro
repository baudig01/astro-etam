---
// src/pages/[...slug].astro - Page dynamique pour afficher toutes les pages
import Layout from '@/layouts/layout.astro';
import { getSingleEntry } from '@/contentstack-sdk/fetchContent';
import '@/styles/index.scss';
import PageContent from '@/components/pageContent.astro';

// Activer le server-side rendering pour les routes dynamiques
export const prerender = false;

// Récupérer le slug depuis les paramètres de la route
const rawSlug = Astro.params.slug;

// Normaliser le slug en array de manière plus robuste
let slug: string[];
if (!rawSlug) {
  slug = [];
} else if (Array.isArray(rawSlug)) {
  slug = rawSlug;
} else if (typeof rawSlug === 'string') {
  // Si c'est une string, la diviser par '/' pour obtenir les segments
  slug = rawSlug.split('/').filter(Boolean);
} else {
  slug = [String(rawSlug)];
}

const url = slug.length > 0 ? `/${slug.join('/')}` : '/';

// Récupérer la page depuis Contentstack
const page = await getSingleEntry('page', { url });

if (!page) {
  return Astro.redirect('/404');
}

const { title, seo_title, seo_description } = page;
---

<Layout 
  title={seo_title || title || 'Page'}
  description={seo_description}
>
  <PageContent page={page} />
</Layout>